@page "/FileUpload"

@using System.IO
@using Microsoft.AspNetCore.Components.Forms
@using SHC.Models

<Field>
    <InputFile OnChange="@OnFileUpload" accept=".txt" />
</Field>
<button @onclick="Submit">Submit</button>

@code {
    private MemoryStream fileContent;
    private bool fileSelected = false;

    async Task OnFileUpload(InputFileChangeEventArgs e)
    {
        var file = e.File; // Handle a single file
        if (file != null)
        {
            fileContent?.Dispose(); // Dispose previous MemoryStream if it exists
            fileContent = new MemoryStream();
            await file.OpenReadStream().CopyToAsync(fileContent);
            fileSelected = true; // Mark as file selected
        }
    }

    void Submit()
    {
        if (fileSelected && fileContent != null)
        {
            try
            {
                fileContent.Position = 0; // Reset the position to read from the beginning
                FileHomeReader fileHomeReader = new FileHomeReader();
                fileHomeReader.readFile(fileContent); // Ensure ReadFile accepts a Stream parameter
                Console.WriteLine(fileHomeReader);
                Console.WriteLine("File uploaded successfully!");
            }
            finally
            {
                fileContent.Dispose(); // Dispose the stream properly
                fileContent = null; // Ensure the reference is cleared
                fileSelected = false; // Reset file selection state
            }
        }
    }
}
